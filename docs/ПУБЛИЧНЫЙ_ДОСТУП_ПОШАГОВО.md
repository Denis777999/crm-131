# Как сделать CRM общедоступной (работа из любой сети и с любого устройства)

Чтобы приложение открывалось не только на localhost, а по ссылке из интернета (с телефона, другого компьютера, другой сети), его нужно **разместить на хостинге**. Ниже — пошаговая настройка через **Vercel** (удобно для Next.js) и настройка **Supabase** под публичный URL.

---

## Что понадобится

- Аккаунт на [GitHub](https://github.com) (бесплатно)
- Аккаунт на [Vercel](https://vercel.com) (бесплатно, привязка к GitHub)
- Уже настроенный проект Supabase (миграции применены, ключи есть в `.env.local`)

---

## Шаг 1. Выложить проект в GitHub

1. Зайдите на [github.com](https://github.com) и войдите в аккаунт.
2. Нажмите **+** → **New repository**.
3. Укажите имя репозитория (например, `crm-11`), оставьте **Public**, репозиторий можно создать **без** README.
4. Нажмите **Create repository**.
5. На компьютере откройте терминал в папке проекта (где лежит `package.json`):
   ```bash
   cd c:\11
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/ВАШ_ЛОГИН/crm-11.git
   git push -u origin main
   ```
   Вместо `ВАШ_ЛОГИН/crm-11` подставьте свой логин и имя репозитория. Если `git` спросит логин/пароль — используйте учётные данные GitHub (для пароля можно использовать [Personal Access Token](https://github.com/settings/tokens)).

Если репозиторий уже создан и проект уже в Git — достаточно выполнить `git push origin main`.

---

## Шаг 2. Подключить проект к Vercel

1. Зайдите на [vercel.com](https://vercel.com), нажмите **Sign Up** и войдите через **GitHub**.
2. После входа нажмите **Add New…** → **Project**.
3. Выберите репозиторий с вашей CRM (например, `crm-11`) и нажмите **Import**.
4. В настройках проекта:
   - **Framework Preset**: Next.js (определится сам).
   - **Root Directory** — оставьте пустым.
   - **Build and Output Settings** — по умолчанию (Build Command: `next build`, Output: Next.js).
5. **Не нажимайте Deploy** — сначала добавьте переменные окружения (шаг 3).

---

## Шаг 3. Добавить переменные окружения в Vercel

1. На странице импорта проекта найдите блок **Environment Variables**.
2. Добавьте по одной переменной (значения берите из `.env.local`):

| Name | Value | окружение |
|------|--------|-----------|
| `NEXT_PUBLIC_SUPABASE_URL` | ваш Supabase Project URL | Production, Preview, Development |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | ваш Supabase anon key | Production, Preview, Development |
| `SUPABASE_SERVICE_ROLE_KEY` | ваш Supabase service_role key | Production, Preview, Development |

3. Для production-создания владельца (по желанию) добавьте:
   | Name | Value | окружение |
   |------|--------|-----------|
   | `SETUP_SECRET` | придумайте сложный секрет (например, длинная случайная строка) | Production |

4. Нажмите **Deploy**. Дождитесь окончания сборки (1–3 минуты).

---

## Шаг 4. Узнать публичный URL приложения

1. После успешного деплоя Vercel покажет страницу проекта.
2. Публичный адрес будет вида: **`https://ваш-проект.vercel.app`** (или `https://ваш-проект-xxx.vercel.app`).
3. Скопируйте этот URL — он понадобится в Supabase.

---

## Шаг 5. Настроить Supabase для публичного URL

Чтобы вход (логин/пароль) и выход работали с любого устройства, Supabase должен доверять вашему домену.

1. Откройте [Supabase Dashboard](https://supabase.com/dashboard) → ваш проект.
2. В левом меню: **Authentication** → **URL Configuration**.
3. Заполните:
   - **Site URL**: вставьте ваш URL от Vercel, например  
     `https://ваш-проект.vercel.app`
   - **Redirect URLs**: добавьте (каждый с новой строки или через запятую):
     - `https://ваш-проект.vercel.app/**`
     - `https://ваш-проект.vercel.app`
     - для теста можно оставить и `http://localhost:3000/**`
4. Нажмите **Save**.

После этого авторизация с любого браузера и сети будет работать на вашем публичном адресе.

---

## Шаг 6. Создать владельца на production (один раз)

На продакшене создание владельца защищено секретом. Если вы задали `SETUP_SECRET` в Vercel:

1. Вызовите API с любого устройства (подставьте свой URL и секрет):
   ```bash
   curl -X POST https://ваш-проект.vercel.app/api/setup-create-owner -H "x-setup-secret: ВАШ_SETUP_SECRET"
   ```
   Или в браузере можно использовать расширение для REST-запросов или сервис вроде Postman: метод **POST**, URL `https://ваш-проект.vercel.app/api/setup-create-owner`, заголовок `x-setup-secret: ВАШ_SETUP_SECRET`.
2. В ответе должно быть сообщение о создании пользователя или о том, что он уже есть.
3. После этого входите на **https://ваш-проект.vercel.app/login** с логином **anglijskogoucitel2@gmail.com** и паролем **170100den**.

Если владелец уже был создан при работе на localhost (в том же проекте Supabase), дополнительно создавать его не нужно — просто входите по тому же логину и паролю на публичном URL.

---

## Шаг 7. Проверить доступ с любого устройства

1. На телефоне или другом компьютере откройте браузер.
2. Перейдите по ссылке **https://ваш-проект.vercel.app** (или ваш домен).
3. Откройте **/login**, введите логин и пароль владельца — должен открыться дашборд.
4. Данные хранятся в Supabase, поэтому они одни и те же с любого устройства и сети.

---

## Краткий чеклист

- [ ] Код в GitHub
- [ ] Проект импортирован в Vercel
- [ ] В Vercel заданы: `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY` (и при необходимости `SETUP_SECRET`)
- [ ] Деплой прошёл успешно
- [ ] В Supabase в **Authentication → URL Configuration** указаны **Site URL** и **Redirect URLs** с вашим `https://....vercel.app`
- [ ] Владелец создан (если ещё не был) через `POST /api/setup-create-owner`
- [ ] Вход на публичном URL с телефона/другого ПК работает

---

## Важно

- **Интернет нужен**: приложение и база в облаке, поэтому открывать CRM можно с любого устройства и любой сети (домашняя, мобильный интернет, офис), но само устройство должно быть подключено к интернету.
- **Без локальной сети**: после деплоя CRM доступна по ссылке из интернета, привязка к вашему домашнему IP или локальной сети не требуется.
- **Свой домен** (опционально): в Vercel в настройках проекта можно добавить свой домен (например, `crm.ваш-сайт.ru`) и затем добавить этот же URL в Supabase в **Redirect URLs** и **Site URL**.

Если на каком-то шаге появится ошибка — напишите, на каком шаге и какой текст ошибки, и можно будет точечно подсказать.
