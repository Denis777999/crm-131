# Пошаговая настройка учётной записи оператора

Чтобы оператор мог входить в CRM по логину и паролю, сделайте всё по шагам.

---

## Шаг 1: Открыть настройки API в Supabase

1. Зайдите на [supabase.com](https://supabase.com) и откройте свой проект.
2. В левом меню выберите **Settings** (Настройки).
3. Откройте раздел **API**.
4. Оставьте эту вкладку открытой — понадобятся ключи с этой страницы.

---

## Шаг 2: Скопировать service_role ключ

1. На странице **Settings → API** найдите блок **Project API keys**.
2. Найдите ключ **service_role** (подпись «secret», его нельзя показывать в коде и на фронте).
3. Нажмите **Reveal** (Показать) и скопируйте ключ целиком (Ctrl+C).  
   Он длинный, начинается с `eyJ...` — скопируйте до конца.

---

## Шаг 3: Добавить ключ в .env.local

1. В корне проекта откройте файл **`.env.local`** (папка `c:\11`, рядом с `package.json`).
2. Если файла нет — создайте новый файл с именем **`.env.local`** (именно с точкой в начале).
3. Добавьте строку (без кавычек и пробелов вокруг `=`):

   ```
   SUPABASE_SERVICE_ROLE_KEY=сюда_вставьте_скопированный_ключ
   ```

4. В итоге в `.env.local` должны быть минимум три строки:

   ```
   NEXT_PUBLIC_SUPABASE_URL=https://ваш-проект.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
   SUPABASE_SERVICE_ROLE_KEY=eyJ...
   ```

5. Сохраните файл (Ctrl+S).

---

## Шаг 4: Проверить имя файла (Windows)

1. В Проводнике откройте папку проекта `c:\11`.
2. Включите отображение расширений: **Вид** → **Показать** → галочка **«Расширения имён файлов»**.
3. Убедитесь, что файл называется **`.env.local`**, а не `.env.local.txt`.
4. Если имя `.env.local.txt` — переименуйте в `.env.local`.

---

## Шаг 5: Выполнить миграцию таблицы операторов в Supabase

1. В Supabase откройте **SQL Editor** (левое меню).
2. Нажмите **New query**.
3. Откройте в проекте файл `supabase/migrations/20260220000000_operator_accounts.sql`.
4. Скопируйте весь его текст и вставьте в запрос в SQL Editor.
5. Нажмите **Run** (или Ctrl+Enter).
6. Внизу должно быть сообщение об успешном выполнении (без красных ошибок).

---

## Шаг 6: Перезапустить сервер

1. Найдите терминал, в котором запущен проект (`npm run dev`).
2. Остановите сервер: нажмите **Ctrl+C**.
3. Запустите снова: выполните команду  
   **`npm run dev`**
4. Дождитесь сообщения вида «Local: http://localhost:3000» (или 3001).

Важно: без перезапуска переменная из `.env.local` не подхватится.

---

## Шаг 7: Войти в CRM как владелец

1. Откройте в браузере **http://localhost:3000** (или тот порт, что показал сервер).
2. Войдите под своим аккаунтом (email и пароль владельца CRM).  
   Если ещё не регистрировались — нажмите «Зарегистрироваться» и создайте аккаунт.

---

## Шаг 8: Создать учётную запись оператора

1. В меню откройте **Операторы**.
2. Нажмите кнопку **«Добавить оператора»**.
3. Заполните:
   - **ФИО** — обязательно;
   - при необходимости: дата рождения, телефон;
   - **Логин (email)** — email, под которым оператор будет входить;
   - **Пароль** — пароль для входа оператора.
4. Нажмите **«Добавить»**.
5. Если всё настроено верно, появится сообщение об успешном создании учётной записи (без ошибки «Сервис недоступен»).

---

## Шаг 9: Проверить вход оператора

1. Выйдите из аккаунта (если есть кнопка «Выйти»).
2. На странице входа введите **логин (email)** и **пароль**, которые указали для оператора.
3. Нажмите «Войти».
4. Должен открыться дашборд CRM в роли оператора (ограниченный набор разделов).

---

## Если снова появляется «Сервис недоступен»

- Повторите **Шаг 6** (остановить сервер, снова запустить `npm run dev`).
- Убедитесь, что в `.env.local` строка `SUPABASE_SERVICE_ROLE_KEY=...` одна, без лишних пробелов и кавычек.
- Проверьте, что миграция из **Шага 5** выполнена без ошибок.

После этого создание учётной записи оператора и вход по логину и паролю должны работать.
