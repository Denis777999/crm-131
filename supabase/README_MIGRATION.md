# Сохранение всей информации CRM в облаке (Supabase)

Чтобы **вся информация** сохранялась в облаке и была доступна с любого устройства:

## Шаг 1: Проект Supabase

1. Зайдите на [supabase.com](https://supabase.com) и создайте проект (или откройте существующий).
2. В проекте: **Settings → API** — скопируйте:
   - **Project URL** → это `NEXT_PUBLIC_SUPABASE_URL`
   - **anon public** key → это `NEXT_PUBLIC_SUPABASE_ANON_KEY`

## Шаг 2: Переменные окружения

В корне проекта создайте или отредактируйте `.env.local`:

```env
NEXT_PUBLIC_SUPABASE_URL=https://ваш-проект.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=ваш_anon_ключ
```

Если нужны **учётные записи операторов** (логин/пароль при добавлении оператора, чтобы оператор мог войти в CRM):

- Пошаговая инструкция: **`docs/ПОШАГОВО_УЧЕТНАЯ_ЗАПИСЬ_ОПЕРАТОРА.md`**
- Кратко: в Supabase **Settings → API** скопируйте **service_role** key → добавьте в `.env.local` строку `SUPABASE_SERVICE_ROLE_KEY=...` → выполните миграцию `supabase/migrations/20260220000000_operator_accounts.sql` в SQL Editor → **перезапустите** `npm run dev`.

## Шаг 3: Схема базы данных

В [Supabase Dashboard](https://supabase.com/dashboard) откройте ваш проект → **SQL Editor** → New query.

1. Скопируйте и выполните `supabase/migrations/20260215000000_crm_schema.sql` — создадутся таблицы `crm_*` и RLS.
2. Если используете учётные записи операторов — выполните также `supabase/migrations/20260220000000_operator_accounts.sql` и `supabase/migrations/20260220100000_operator_shifts_rls.sql` (чтобы оператор видел свои смены в списке).

## Шаг 4: Вход в приложение

- На странице входа нажмите **«Зарегистрироваться»** и создайте аккаунт (email + пароль).
- Либо войдите, если аккаунт уже есть.

После входа **все данные** (операторы, модели, пары, смены, финансы, настройки, фото и т.д.) автоматически сохраняются в Supabase и привязаны к вашему пользователю.

## Как это устроено

| Состояние | Где хранятся данные |
|-----------|----------------------|
| Вы **вошли** в аккаунт | Чтение и запись в **Supabase** (облако). Дополнительно копия в localStorage для офлайна. |
| Не вошли или Supabase не настроен | Только **localStorage** в браузере. |

## Перенос старых данных из браузера

Если раньше вы работали без входа и накопили данные в браузере:

1. Войдите в аккаунт.
2. Откройте **Настройки → Импорт** и нажмите «Импорт из этого браузера» — данные из localStorage будут загружены в облако.

Либо просто откройте разделы CRM и при необходимости заново сохраните записи — при каждой записи данные отправляются в Supabase.
